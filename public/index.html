<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$WATT â€” Ride to Earn</title>
  <style>
    :root { --primary: #00ff7f; --background: #0a0a0a; --text: #f2f2f2; --card: #1a1a1a; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: var(--background); color: var(--text); font-family: 'Segoe UI', sans-serif; }
    header, section { max-width: 800px; margin: 2rem auto; padding: 2rem; background: var(--card); border-radius: 12px; }
    header { text-align: center; }
    .button { display: inline-block; background: #000; color: var(--primary); border: 2px solid var(--primary); padding: 0.8rem 2rem; border-radius: 999px; text-decoration: none; font-weight: bold; }
    .button:hover { background: var(--primary); color: #000; }
    #connect { text-align: center; }
  </style>
</head>
<body>
  <header>
    <h1>$WATT</h1>
    <p>Mine crypto with your rides. Connect Strava to start earning.</p>
  </header>

  <section class="how-it-works">
    <h2>How It Works</h2>
    <ol>
      <li><strong>Track:</strong> Ride with a power meter to capture wattage.</li>
      <li><strong>Sync:</strong> We fetch your last 10 rides for speed.</li>
      <li><strong>Mint:</strong> Convert watt-hours into $WATT tokens.</li>
      <li><strong>Flex:</strong> View your earned tokens and leaderboard.</li>
    </ol>
  </section>

  <section id="connect">
    <h2>Connect with Strava</h2>
    <a class="button" href="https://www.strava.com/oauth/authorize?client_id=161922&response_type=code&redirect_uri=https://melodious-queijadas-d749fe.netlify.app/.netlify/functions/strava-auth&approval_prompt=auto&scope=activity:read_all">
      ðŸš´ Connect Strava Now
    </a>
  </section>

  <section id="your-balance">
    <h2>Your $WATT</h2>
    <div id="watt-display">Loading...</div>
  </section>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
    const config = { apiKey:'AIzaSyAuklQzaRb5kqqn3WiwqLQDOvFo6JdYgMA', authDomain:'wattcoinstorage.firebaseapp.com', projectId:'wattcoinstorage' };
    const app = initializeApp(config), db = getFirestore(app);
    const athleteId = localStorage.getItem('athlete_id');
    if (athleteId) {
      getDoc(doc(db,'users',athleteId)).then(snap => {
        document.getElementById('watt-display').innerText = snap.exists() ?
          `You've earned ${snap.data().watt_token} $WATT from ${snap.data().activities_count} rides.` :
          'No data found.';
      });
    }
  </script>
</body>
</html>
